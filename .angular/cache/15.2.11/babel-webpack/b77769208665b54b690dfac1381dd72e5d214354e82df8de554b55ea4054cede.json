{"ast":null,"code":"import { CommonModule } from '@angular/common';\nimport { Validators, ReactiveFormsModule } from '@angular/forms';\nimport { FormsModule } from '@angular/forms';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../services/api.service\";\nimport * as i2 from \"../../services/notification.service\";\nimport * as i3 from \"@angular/forms\";\nexport let OrdersComponent = /*#__PURE__*/(() => {\n  class OrdersComponent {\n    constructor(apiService, notificationService, fb) {\n      this.apiService = apiService;\n      this.notificationService = notificationService;\n      this.fb = fb;\n      this.orders = [];\n      this.currentPage = 1;\n      this.itemsPerPage = 10;\n      this.totalItems = 0;\n      this.totalPages = 0;\n      this.isLoading = false;\n      this.showStatusModal = false;\n      this.showDetailsModal = false;\n      this.selectedOrder = null;\n      this.statusFilter = '';\n      this.Math = Math;\n      this.statusForm = this.fb.group({\n        status: ['', Validators.required]\n      });\n    }\n    ngOnInit() {\n      this.loadOrders();\n    }\n    loadOrders() {\n      this.isLoading = true;\n      const params = {\n        page: this.currentPage,\n        limit: this.itemsPerPage,\n        sort: '-createdAt'\n      };\n      // Add status filter to query params if set\n      if (this.statusFilter) {\n        params.keyword = this.statusFilter; // Note: API may need status filter in a different way\n      }\n\n      this.apiService.getPaginated('/Order', params).subscribe({\n        next: response => {\n          let orders = response.data || [];\n          // Apply client-side filtering if API doesn't support status filter\n          if (this.statusFilter) {\n            orders = orders.filter(order => order.status === this.statusFilter);\n          }\n          this.orders = orders;\n          // Use unified pagination format from API\n          if (response.pagination) {\n            this.totalItems = response.pagination.totalItems || 0;\n            this.totalPages = response.pagination.totalPages || 0;\n            if (response.pagination.itemsPerPage) {\n              this.itemsPerPage = response.pagination.itemsPerPage;\n            }\n          } else {\n            const ordersLength = this.orders.length;\n            this.totalItems = ordersLength;\n            this.totalPages = ordersLength > 0 ? Math.max(1, Math.ceil(ordersLength / this.itemsPerPage)) : 0;\n          }\n          this.isLoading = false;\n        },\n        error: error => {\n          console.error('Error loading orders:', error);\n          this.isLoading = false;\n          this.totalPages = 0;\n          this.totalItems = 0;\n          this.notificationService.error('Error', 'Failed to load orders');\n        }\n      });\n    }\n    onStatusFilter() {\n      this.currentPage = 1;\n      this.loadOrders();\n    }\n    goToPage(page) {\n      if (page >= 1 && page <= this.totalPages) {\n        this.currentPage = page;\n        this.loadOrders();\n      }\n    }\n    showDetailsModal(order) {\n      this.apiService.getById('/Order', order._id).subscribe({\n        next: response => {\n          this.selectedOrder = response.data || order;\n          this.showDetailsModal = true;\n          document.body.classList.add('modal-open');\n        },\n        error: error => {\n          console.error('Error loading order details:', error);\n          this.selectedOrder = order;\n          this.showDetailsModal = true;\n          document.body.classList.add('modal-open');\n          this.notificationService.error('Warning', 'Could not load full order details. Some data may be incomplete.');\n        }\n      });\n    }\n    showUpdateStatusModal(order) {\n      this.selectedOrder = order;\n      this.statusForm.patchValue({\n        status: order.status\n      });\n      this.showStatusModal = true;\n      document.body.classList.add('modal-open');\n    }\n    updateStatus() {\n      if (this.statusForm.valid && this.selectedOrder) {\n        const statusData = {\n          status: this.statusForm.value.status\n        };\n        this.apiService.putCustom(`/Order/${this.selectedOrder._id}/status`, statusData).subscribe({\n          next: response => {\n            this.notificationService.success('Success', 'Order status updated successfully');\n            this.closeModals();\n            this.loadOrders();\n          },\n          error: error => {\n            var _a;\n            console.error('Error updating order status:', error);\n            this.notificationService.error('Error', ((_a = error.error) === null || _a === void 0 ? void 0 : _a.message) || 'Failed to update order status');\n          }\n        });\n      }\n    }\n    closeModals() {\n      this.showStatusModal = false;\n      this.showDetailsModal = false;\n      this.selectedOrder = null;\n      document.body.classList.remove('modal-open');\n    }\n    getStatusClass(status) {\n      switch (status) {\n        case 'completed':\n          return 'bg-success';\n        case 'cancelled':\n          return 'bg-danger';\n        default:\n          return 'bg-warning';\n      }\n    }\n    getStatusLabel(status) {\n      return status.charAt(0).toUpperCase() + status.slice(1);\n    }\n    get filteredOrders() {\n      return this.orders;\n    }\n    get pageNumbers() {\n      if (!this.totalPages || this.totalPages <= 0) {\n        return [];\n      }\n      return Array.from({\n        length: this.totalPages\n      }, (_, i) => i + 1);\n    }\n  }\n  OrdersComponent.ɵfac = function OrdersComponent_Factory(t) {\n    return new (t || OrdersComponent)(i0.ɵɵdirectiveInject(i1.ApiService), i0.ɵɵdirectiveInject(i2.NotificationService), i0.ɵɵdirectiveInject(i3.FormBuilder));\n  };\n  OrdersComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: OrdersComponent,\n    selectors: [[\"app-orders\"]],\n    standalone: true,\n    features: [i0.ɵɵStandaloneFeature],\n    decls: 6,\n    vars: 0,\n    consts: [[1, \"min-h-screen\", \"bg-gray-50\", \"dark:bg-gray-900\"], [1, \"p-4\", \"lg:p-6\"], [1, \"text-2xl\", \"lg:text-3xl\", \"font-bold\", \"text-gray-900\", \"dark:text-white\", \"mb-6\"], [1, \"text-gray-600\", \"dark:text-gray-400\"]],\n    template: function OrdersComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"h1\", 2);\n        i0.ɵɵtext(3, \"Orders Management\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(4, \"p\", 3);\n        i0.ɵɵtext(5, \"Orders management functionality coming soon...\");\n        i0.ɵɵelementEnd()()();\n      }\n    },\n    dependencies: [CommonModule, ReactiveFormsModule, FormsModule]\n  });\n  return OrdersComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}