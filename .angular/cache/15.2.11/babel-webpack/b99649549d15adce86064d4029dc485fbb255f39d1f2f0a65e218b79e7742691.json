{"ast":null,"code":"import { RouterModule, NavigationEnd } from '@angular/router';\nimport { CommonModule } from '@angular/common';\nimport { filter } from 'rxjs/operators';\nimport { interval } from 'rxjs';\nimport { DashboardNotificationToastComponent } from './components/notification-toast/notification-toast.component';\nimport { DashboardSidebarComponent } from './layout/sidebar/sidebar.component';\nimport { DashboardHeaderComponent } from './layout/header/header.component';\nimport { DashboardOverviewComponent } from './layout/overview/overview.component';\nimport { AlertComponent } from './components/alert/alert.component';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../services/dashboard.service\";\nimport * as i2 from \"../services/auth.service\";\nimport * as i3 from \"../services/notification.service\";\nimport * as i4 from \"@angular/router\";\nimport * as i5 from \"@angular/common\";\nfunction AdminDashboardComponent_app_dashboard_overview_8_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r2 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"app-dashboard-overview\", 8);\n    i0.ɵɵlistener(\"addProduct\", function AdminDashboardComponent_app_dashboard_overview_8_Template_app_dashboard_overview_addProduct_0_listener() {\n      i0.ɵɵrestoreView(_r2);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.addProduct());\n    })(\"viewOrders\", function AdminDashboardComponent_app_dashboard_overview_8_Template_app_dashboard_overview_viewOrders_0_listener() {\n      i0.ɵɵrestoreView(_r2);\n      const ctx_r3 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r3.viewOrders());\n    })(\"manageCategories\", function AdminDashboardComponent_app_dashboard_overview_8_Template_app_dashboard_overview_manageCategories_0_listener() {\n      i0.ɵɵrestoreView(_r2);\n      const ctx_r4 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r4.manageCategories());\n    })(\"viewMessages\", function AdminDashboardComponent_app_dashboard_overview_8_Template_app_dashboard_overview_viewMessages_0_listener() {\n      i0.ɵɵrestoreView(_r2);\n      const ctx_r5 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r5.viewMessages());\n    });\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"stats\", ctx_r0.stats)(\"recentActivity\", ctx_r0.recentActivity)(\"isLoading\", ctx_r0.isLoading);\n  }\n}\nexport let AdminDashboardComponent = /*#__PURE__*/(() => {\n  class AdminDashboardComponent {\n    constructor(dashboardService, authService, notificationService, router) {\n      this.dashboardService = dashboardService;\n      this.authService = authService;\n      this.notificationService = notificationService;\n      this.router = router;\n      this.stats = {\n        totalProducts: 0,\n        totalOrders: 0,\n        pendingOrders: 0,\n        totalRevenue: 0,\n        unreadMessages: 0\n      };\n      this.recentActivity = [];\n      this.isLoading = true;\n      this.sidebarCollapsed = false;\n      this.showDashboard = true;\n      this.alerts = [];\n      this.alertTimeouts = new Map();\n      this.REFRESH_INTERVAL = 30000; // 30 seconds\n      this.ALERT_AUTO_HIDE_DURATION = 5000; // 5 seconds\n    }\n\n    ngOnInit() {\n      this.loadDashboardData();\n      this.checkAuthStatus();\n      this.updateDashboardVisibility();\n      this.startRealTimeUpdates();\n      this.setupAlertListeners();\n      // Listen to route changes to update dashboard visibility\n      this.router.events.pipe(filter(event => event instanceof NavigationEnd)).subscribe(() => {\n        this.updateDashboardVisibility();\n      });\n    }\n    ngOnDestroy() {\n      // Clean up interval subscription\n      if (this.dataRefreshInterval) {\n        this.dataRefreshInterval.unsubscribe();\n      }\n      // Clear all alert timeouts\n      this.alertTimeouts.forEach(timeout => clearTimeout(timeout));\n      this.alertTimeouts.clear();\n    }\n    /**\n     * Start real-time updates for dashboard data\n     * Updates data every 30 seconds without page refresh\n     */\n    startRealTimeUpdates() {\n      // Only update when dashboard is visible\n      this.dataRefreshInterval = interval(this.REFRESH_INTERVAL).subscribe(() => {\n        if (this.showDashboard && !this.isLoading) {\n          this.loadDashboardData();\n        }\n      });\n    }\n    updateDashboardVisibility() {\n      const url = this.router.url;\n      // Show dashboard overview only when on /admin exactly or /admin/, hide it when on child routes\n      this.showDashboard = url === '/admin' || url === '/admin/';\n    }\n    loadDashboardData() {\n      this.isLoading = true;\n      // Fetch all dashboard data from API - no static/hardcoded data\n      let statsLoaded = false;\n      let activityLoaded = false;\n      const checkLoadingComplete = () => {\n        if (statsLoaded && activityLoaded) {\n          this.isLoading = false;\n        }\n      };\n      // Load stats from API\n      this.dashboardService.getDashboardStats().subscribe({\n        next: stats => {\n          // All data comes from API endpoints according to API documentation\n          // Stats endpoint: GET /Order/stats\n          // Products count: GET /product (results field)\n          // Messages count: GET /submit (filter by isReplied: false)\n          this.stats = {\n            totalProducts: stats.totalProducts || 0,\n            totalOrders: stats.totalOrders || 0,\n            pendingOrders: stats.pendingOrders || 0,\n            totalRevenue: stats.totalRevenue || 0,\n            unreadMessages: stats.unreadMessages || 0\n          };\n          statsLoaded = true;\n          checkLoadingComplete();\n        },\n        error: error => {\n          console.error('Error loading dashboard stats from API:', error);\n          this.notificationService.error('Error', 'Failed to load dashboard statistics');\n          // Set defaults to 0 if API fails (no static data)\n          this.stats = {\n            totalProducts: 0,\n            totalOrders: 0,\n            pendingOrders: 0,\n            totalRevenue: 0,\n            unreadMessages: 0\n          };\n          statsLoaded = true;\n          checkLoadingComplete();\n        }\n      });\n      // Load recent activity from API\n      this.dashboardService.getRecentActivity().subscribe({\n        next: activity => {\n          // Recent activity comes from API:\n          // - Recent orders: GET /Order?limit=5&sort=-createdAt\n          // - Recent products: GET /product?limit=5&sort=-createdAt\n          // - Recent messages: GET /submit?limit=5&sort=-createdAt\n          this.recentActivity = activity || [];\n          activityLoaded = true;\n          checkLoadingComplete();\n        },\n        error: error => {\n          console.error('Error loading recent activity from API:', error);\n          this.notificationService.error('Error', 'Failed to load recent activity');\n          // Empty array if API fails (no static data)\n          this.recentActivity = [];\n          activityLoaded = true;\n          checkLoadingComplete();\n        }\n      });\n    }\n    checkAuthStatus() {\n      if (!this.authService.isAuthenticated() || !this.authService.isAdmin()) {\n        this.router.navigate(['/login']);\n      }\n    }\n    toggleSidebar() {\n      this.sidebarCollapsed = !this.sidebarCollapsed;\n    }\n    logout() {\n      this.authService.logout();\n    }\n    addProduct() {\n      this.router.navigate(['/admin/products']);\n    }\n    viewOrders() {\n      this.router.navigate(['/admin/orders']);\n    }\n    manageCategories() {\n      this.router.navigate(['/admin/categories']);\n    }\n    viewMessages() {\n      this.router.navigate(['/admin/contact-forms']);\n    }\n    /**\n     * Setup listeners for notification service to show alerts in main area\n     */\n    setupAlertListeners() {\n      // Listen to notification service for main area alerts\n      this.notificationService.notifications$.subscribe(notifications => {\n        // Show the latest notification in main area\n        if (notifications.length > 0) {\n          const latest = notifications[notifications.length - 1];\n          // Check if alert doesn't already exist\n          if (!this.alerts.find(a => a.id === latest.id)) {\n            this.showAlert(latest.type, latest.title, latest.message);\n          }\n        }\n      });\n    }\n    /**\n     * Show an alert in the main content area\n     */\n    showAlert(type, title, message) {\n      const id = `alert-${Date.now()}-${Math.random().toString(36).substring(2, 11)}`;\n      this.alerts.push({\n        id,\n        type,\n        title,\n        message\n      });\n      // Auto-hide after duration\n      const timeout = setTimeout(() => {\n        this.dismissAlert(id);\n      }, this.ALERT_AUTO_HIDE_DURATION);\n      this.alertTimeouts.set(id, timeout);\n    }\n    /**\n     * Dismiss an alert manually\n     */\n    dismissAlert(id) {\n      const index = this.alerts.findIndex(alert => alert.id === id);\n      if (index > -1) {\n        this.alerts.splice(index, 1);\n      }\n      // Clear timeout if exists\n      const timeout = this.alertTimeouts.get(id);\n      if (timeout) {\n        clearTimeout(timeout);\n        this.alertTimeouts.delete(id);\n      }\n    }\n  }\n  AdminDashboardComponent.ɵfac = function AdminDashboardComponent_Factory(t) {\n    return new (t || AdminDashboardComponent)(i0.ɵɵdirectiveInject(i1.DashboardService), i0.ɵɵdirectiveInject(i2.AuthService), i0.ɵɵdirectiveInject(i3.NotificationService), i0.ɵɵdirectiveInject(i4.Router));\n  };\n  AdminDashboardComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: AdminDashboardComponent,\n    selectors: [[\"app-admin-dashboard\"]],\n    standalone: true,\n    features: [i0.ɵɵStandaloneFeature],\n    decls: 11,\n    vars: 9,\n    consts: [[1, \"dashboard-wrapper\"], [3, \"pendingOrders\", \"unreadMessages\", \"toggleSidebar\"], [1, \"dashboard-container\"], [3, \"sidebarCollapsed\", \"pendingOrders\", \"unreadMessages\", \"toggleSidebar\", \"logout\"], [1, \"main-content\"], [1, \"content-area\", \"thin-scrollbar\", 2, \"position\", \"relative\"], [3, \"alerts\", \"dismiss\"], [3, \"stats\", \"recentActivity\", \"isLoading\", \"addProduct\", \"viewOrders\", \"manageCategories\", \"viewMessages\", 4, \"ngIf\"], [3, \"stats\", \"recentActivity\", \"isLoading\", \"addProduct\", \"viewOrders\", \"manageCategories\", \"viewMessages\"]],\n    template: function AdminDashboardComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0)(1, \"app-dashboard-header\", 1);\n        i0.ɵɵlistener(\"toggleSidebar\", function AdminDashboardComponent_Template_app_dashboard_header_toggleSidebar_1_listener() {\n          return ctx.toggleSidebar();\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(2, \"div\", 2)(3, \"app-dashboard-sidebar\", 3);\n        i0.ɵɵlistener(\"toggleSidebar\", function AdminDashboardComponent_Template_app_dashboard_sidebar_toggleSidebar_3_listener() {\n          return ctx.toggleSidebar();\n        })(\"logout\", function AdminDashboardComponent_Template_app_dashboard_sidebar_logout_3_listener() {\n          return ctx.logout();\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(4, \"main\", 4)(5, \"app-dashboard-header\", 1);\n        i0.ɵɵlistener(\"toggleSidebar\", function AdminDashboardComponent_Template_app_dashboard_header_toggleSidebar_5_listener() {\n          return ctx.toggleSidebar();\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(6, \"div\", 5)(7, \"app-alert\", 6);\n        i0.ɵɵlistener(\"dismiss\", function AdminDashboardComponent_Template_app_alert_dismiss_7_listener($event) {\n          return ctx.dismissAlert($event);\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(8, AdminDashboardComponent_app_dashboard_overview_8_Template, 1, 3, \"app-dashboard-overview\", 7);\n        i0.ɵɵelement(9, \"router-outlet\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelement(10, \"app-dashboard-notification-toast\");\n        i0.ɵɵelementEnd();\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"pendingOrders\", ctx.stats.pendingOrders)(\"unreadMessages\", ctx.stats.unreadMessages);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"sidebarCollapsed\", ctx.sidebarCollapsed)(\"pendingOrders\", ctx.stats.pendingOrders)(\"unreadMessages\", ctx.stats.unreadMessages);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"pendingOrders\", ctx.stats.pendingOrders)(\"unreadMessages\", ctx.stats.unreadMessages);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"alerts\", ctx.alerts);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.showDashboard);\n      }\n    },\n    dependencies: [CommonModule, i5.NgIf, RouterModule, i4.RouterOutlet, DashboardNotificationToastComponent, DashboardSidebarComponent, DashboardHeaderComponent, DashboardOverviewComponent, AlertComponent],\n    styles: [\".dashboard-wrapper[_ngcontent-%COMP%]{min-height:100vh;background:var(--color-bg-secondary);position:relative}.dashboard-container[_ngcontent-%COMP%]{display:flex;min-height:calc(100vh - 64px)}.main-content[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;width:100%;margin-left:0}.content-area[_ngcontent-%COMP%]{flex:1;padding:var(--spacing-6);overflow-y:auto;background:var(--color-bg-secondary)}@media (min-width: 768px){.dashboard-container[_ngcontent-%COMP%]{min-height:100vh}.main-content[_ngcontent-%COMP%]{margin-left:0}.content-area[_ngcontent-%COMP%]{padding:var(--spacing-6) var(--spacing-8)}}@media (min-width: 1024px){.content-area[_ngcontent-%COMP%]{padding:var(--spacing-8)}}@media (min-width: 1280px){.content-area[_ngcontent-%COMP%]{padding:var(--spacing-8) var(--spacing-12)}}@media print{.dashboard-container[_ngcontent-%COMP%]{display:block}.content-area[_ngcontent-%COMP%]{padding:0}}\"]\n  });\n  return AdminDashboardComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}