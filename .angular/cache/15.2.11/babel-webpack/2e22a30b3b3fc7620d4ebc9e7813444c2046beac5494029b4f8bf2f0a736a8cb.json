{"ast":null,"code":"import { HttpHeaders } from '@angular/common/http';\nimport { forkJoin } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport { environment } from '../../environments/environment';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nexport let DashboardService = /*#__PURE__*/(() => {\n  class DashboardService {\n    constructor(http) {\n      this.http = http;\n      this.apiUrl = environment.apiUrl;\n      this.token = localStorage.getItem('jwt');\n      this.headers = new HttpHeaders({\n        'Authorization': `Bearer ${this.token}`,\n        'Content-Type': 'application/json'\n      });\n    }\n    /**\n     * Get comprehensive dashboard statistics\n     */\n    getDashboardStats() {\n      return forkJoin({\n        products: this.getProductsCount(),\n        orders: this.getOrdersStats(),\n        users: this.getUsersCount(),\n        messages: this.getUnreadMessagesCount()\n      }).pipe(map(data => ({\n        totalProducts: data.products,\n        totalOrders: data.orders.total,\n        pendingOrders: data.orders.pending,\n        totalRevenue: data.orders.revenue,\n        totalUsers: data.users,\n        unreadMessages: data.messages\n      })));\n    }\n    /**\n     * Get recent activity across all modules\n     */\n    getRecentActivity() {\n      return forkJoin({\n        recentOrders: this.getRecentOrders(),\n        recentProducts: this.getRecentProducts(),\n        recentMessages: this.getRecentMessages()\n      }).pipe(map(data => {\n        const activities = [];\n        // Add recent orders\n        data.recentOrders.forEach(order => {\n          var _a;\n          activities.push({\n            id: order._id,\n            description: `New order #${order.orderNumber || order._id.slice(-6)} from ${((_a = order.user) === null || _a === void 0 ? void 0 : _a.name) || 'Customer'}`,\n            timestamp: new Date(order.createdAt),\n            type: 'order'\n          });\n        });\n        // Add recent products\n        data.recentProducts.forEach(product => {\n          activities.push({\n            id: product._id,\n            description: `Product \"${product.title}\" was added`,\n            timestamp: new Date(product.createdAt),\n            type: 'product'\n          });\n        });\n        // Add recent messages\n        data.recentMessages.forEach(message => {\n          activities.push({\n            id: message._id,\n            description: `New message from ${message.name}`,\n            timestamp: new Date(message.createdAt),\n            type: 'message'\n          });\n        });\n        // Sort by timestamp (most recent first) and return top 10\n        return activities.sort((a, b) => b.timestamp.getTime() - a.timestamp.getTime()).slice(0, 10);\n      }));\n    }\n    /**\n     * Get products count\n     */\n    getProductsCount() {\n      return this.http.get(`${this.apiUrl}/product?limit=1`, {\n        headers: this.headers\n      }).pipe(map(response => response.totalCount || 0));\n    }\n    /**\n     * Get orders statistics\n     */\n    getOrdersStats() {\n      return this.http.get(`${this.apiUrl}/Order/stats`, {\n        headers: this.headers\n      }).pipe(map(response => ({\n        total: response.totalOrders || 0,\n        pending: response.pendingOrders || 0,\n        revenue: response.totalRevenue || 0\n      })));\n    }\n    /**\n     * Get users count\n     */\n    getUsersCount() {\n      return this.http.get(`${this.apiUrl}/user?limit=1`, {\n        headers: this.headers\n      }).pipe(map(response => response.totalCount || 0));\n    }\n    /**\n     * Get unread messages count\n     */\n    getUnreadMessagesCount() {\n      return this.http.get(`${this.apiUrl}/submit?isReplied=false&limit=1`, {\n        headers: this.headers\n      }).pipe(map(response => response.totalCount || 0));\n    }\n    /**\n     * Get recent orders\n     */\n    getRecentOrders() {\n      return this.http.get(`${this.apiUrl}/Order?limit=5&sort=-createdAt`, {\n        headers: this.headers\n      }).pipe(map(response => response.data || []));\n    }\n    /**\n     * Get recent products\n     */\n    getRecentProducts() {\n      return this.http.get(`${this.apiUrl}/product?limit=5&sort=-createdAt`, {\n        headers: this.headers\n      }).pipe(map(response => response.data || []));\n    }\n    /**\n     * Get recent messages\n     */\n    getRecentMessages() {\n      return this.http.get(`${this.apiUrl}/submit?limit=5&sort=-createdAt`, {\n        headers: this.headers\n      }).pipe(map(response => response.data || []));\n    }\n    /**\n     * Get shipping information\n     */\n    getShippingInfo() {\n      return this.http.get(`${this.apiUrl}/settings/shipping/info`, {\n        headers: this.headers\n      });\n    }\n    /**\n     * Calculate shipping cost\n     */\n    calculateShipping(totalAmount) {\n      return this.http.post(`${this.apiUrl}/settings/shipping/calculate`, {\n        totalAmount\n      }, {\n        headers: this.headers\n      });\n    }\n  }\n  DashboardService.ɵfac = function DashboardService_Factory(t) {\n    return new (t || DashboardService)(i0.ɵɵinject(i1.HttpClient));\n  };\n  DashboardService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: DashboardService,\n    factory: DashboardService.ɵfac,\n    providedIn: 'root'\n  });\n  return DashboardService;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}