{"ast":null,"code":"import { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { Validators, ReactiveFormsModule } from '@angular/forms';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../services/api.service\";\nimport * as i2 from \"../../services/notification.service\";\nimport * as i3 from \"@angular/forms\";\nexport let ContactFormsComponent = /*#__PURE__*/(() => {\n  class ContactFormsComponent {\n    constructor(apiService, notificationService, fb) {\n      this.apiService = apiService;\n      this.notificationService = notificationService;\n      this.fb = fb;\n      this.contactForms = [];\n      this.currentPage = 1;\n      this.itemsPerPage = 10;\n      this.totalItems = 0;\n      this.totalPages = 0;\n      this.searchTerm = '';\n      this.sortBy = 'createdAt';\n      this.sortOrder = 'desc';\n      this.isLoading = false;\n      this.showViewModal = false;\n      this.showReplyModal = false;\n      this.showDeleteModal = false;\n      this.selectedForm = null;\n      this.filterReplied = '';\n      this.searchTimeout = null;\n      this.Math = Math;\n      this.replyForm = this.fb.group({\n        adminReply: ['', [Validators.required, Validators.minLength(1), Validators.maxLength(1000)]]\n      });\n    }\n    ngOnInit() {\n      this.loadContactForms();\n    }\n    ngOnDestroy() {\n      if (this.searchTimeout) {\n        clearTimeout(this.searchTimeout);\n      }\n    }\n    loadContactForms() {\n      this.isLoading = true;\n      const params = {\n        page: this.currentPage,\n        limit: this.itemsPerPage,\n        sort: `${this.sortOrder === 'desc' ? '-' : ''}${this.sortBy}`,\n        keyword: this.searchTerm || undefined\n      };\n      this.apiService.getPaginated('/submit', params).subscribe({\n        next: response => {\n          let forms = response.data || [];\n          if (this.filterReplied === 'replied') {\n            forms = forms.filter(form => form.isReplied);\n          } else if (this.filterReplied === 'unreplied') {\n            forms = forms.filter(form => !form.isReplied);\n          }\n          this.contactForms = forms;\n          if (response.pagination) {\n            this.totalItems = response.pagination.totalItems || 0;\n            this.totalPages = response.pagination.totalPages || 0;\n            if (response.pagination.itemsPerPage) {\n              this.itemsPerPage = response.pagination.itemsPerPage;\n            }\n          } else {\n            const formsLength = this.contactForms.length;\n            this.totalItems = formsLength;\n            this.totalPages = formsLength > 0 ? Math.max(1, Math.ceil(formsLength / this.itemsPerPage)) : 0;\n          }\n          this.isLoading = false;\n        },\n        error: error => {\n          console.error('Error loading contact forms:', error);\n          this.isLoading = false;\n          this.totalPages = 0;\n          this.totalItems = 0;\n          this.notificationService.error('Error', 'Failed to load contact messages');\n        }\n      });\n    }\n    onSearch() {\n      this.currentPage = 1;\n      this.loadContactForms();\n    }\n    onSearchInput() {\n      if (this.searchTimeout) {\n        clearTimeout(this.searchTimeout);\n      }\n      this.searchTimeout = setTimeout(() => {\n        this.currentPage = 1;\n        this.loadContactForms();\n      }, 500);\n    }\n    onSort(field) {\n      if (this.sortBy === field) {\n        this.sortOrder = this.sortOrder === 'asc' ? 'desc' : 'asc';\n      } else {\n        this.sortBy = field;\n        this.sortOrder = 'desc';\n      }\n      this.loadContactForms();\n    }\n    onFilter() {\n      this.currentPage = 1;\n      this.loadContactForms();\n    }\n    goToPage(page) {\n      if (page >= 1 && page <= this.totalPages) {\n        this.currentPage = page;\n        this.loadContactForms();\n      }\n    }\n    showViewMessageModal(form) {\n      this.selectedForm = form;\n      this.showViewModal = true;\n      document.body.classList.add('modal-open');\n    }\n    showReplyFormModal(form) {\n      const formToUse = form || this.selectedForm;\n      if (formToUse) {\n        this.selectedForm = formToUse;\n        this.replyForm.patchValue({\n          adminReply: formToUse.adminReply || ''\n        });\n        this.showReplyModal = true;\n        document.body.classList.add('modal-open');\n      }\n    }\n    submitReply() {\n      if (this.replyForm.valid && this.selectedForm) {\n        const replyData = {\n          adminReply: this.replyForm.value.adminReply\n        };\n        this.apiService.postCustom(`/submit/${this.selectedForm._id}/reply`, replyData).subscribe({\n          next: response => {\n            this.notificationService.success('Success', 'Reply sent successfully');\n            this.closeModals();\n            this.loadContactForms();\n          },\n          error: error => {\n            var _a;\n            console.error('Error sending reply:', error);\n            this.notificationService.error('Error', ((_a = error.error) === null || _a === void 0 ? void 0 : _a.message) || 'Failed to send reply');\n          }\n        });\n      }\n    }\n    showDeleteMessageModal(form) {\n      this.selectedForm = form;\n      this.showDeleteModal = true;\n      document.body.classList.add('modal-open');\n    }\n    deleteMessage() {\n      if (this.selectedForm) {\n        this.apiService.delete('/submit', this.selectedForm._id).subscribe({\n          next: response => {\n            this.notificationService.success('Success', 'Message deleted successfully');\n            this.closeModals();\n            this.loadContactForms();\n          },\n          error: error => {\n            var _a;\n            console.error('Error deleting message:', error);\n            this.notificationService.error('Error', ((_a = error.error) === null || _a === void 0 ? void 0 : _a.message) || 'Failed to delete message');\n          }\n        });\n      }\n    }\n    closeModals() {\n      this.showViewModal = false;\n      this.showReplyModal = false;\n      this.showDeleteModal = false;\n      this.selectedForm = null;\n      this.replyForm.reset();\n      document.body.classList.remove('modal-open');\n    }\n    getMessagePreview(message, maxLength = 50) {\n      if (!message) return '';\n      if (message.length <= maxLength) return message;\n      return message.substring(0, maxLength) + '...';\n    }\n    get filteredContactForms() {\n      return this.contactForms;\n    }\n    get pageNumbers() {\n      if (!this.totalPages || this.totalPages <= 0) {\n        return [];\n      }\n      return Array.from({\n        length: this.totalPages\n      }, (_, i) => i + 1);\n    }\n    getFieldError(formGroup, fieldName) {\n      var _a, _b, _c;\n      const control = formGroup.get(fieldName);\n      if (control && control.invalid && (control.dirty || control.touched)) {\n        if ((_a = control.errors) === null || _a === void 0 ? void 0 : _a['required']) {\n          return `${this.getFieldLabel(fieldName)} is required`;\n        }\n        if ((_b = control.errors) === null || _b === void 0 ? void 0 : _b['minlength']) {\n          const minLength = control.errors['minlength'].requiredLength;\n          return `${this.getFieldLabel(fieldName)} must be at least ${minLength} characters`;\n        }\n        if ((_c = control.errors) === null || _c === void 0 ? void 0 : _c['maxlength']) {\n          const maxLength = control.errors['maxlength'].requiredLength;\n          return `${this.getFieldLabel(fieldName)} must not exceed ${maxLength} characters`;\n        }\n      }\n      return '';\n    }\n    hasFieldError(formGroup, fieldName) {\n      const control = formGroup.get(fieldName);\n      return !!(control && control.invalid && (control.dirty || control.touched));\n    }\n    getFieldLabel(fieldName) {\n      const labels = {\n        adminReply: 'Admin Reply'\n      };\n      return labels[fieldName] || fieldName;\n    }\n  }\n  ContactFormsComponent.ɵfac = function ContactFormsComponent_Factory(t) {\n    return new (t || ContactFormsComponent)(i0.ɵɵdirectiveInject(i1.ApiService), i0.ɵɵdirectiveInject(i2.NotificationService), i0.ɵɵdirectiveInject(i3.FormBuilder));\n  };\n  ContactFormsComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: ContactFormsComponent,\n    selectors: [[\"app-contact-forms\"]],\n    standalone: true,\n    features: [i0.ɵɵStandaloneFeature],\n    decls: 6,\n    vars: 0,\n    consts: [[1, \"min-h-screen\", \"bg-gray-50\", \"dark:bg-gray-900\"], [1, \"p-4\", \"lg:p-6\"], [1, \"text-2xl\", \"lg:text-3xl\", \"font-bold\", \"text-gray-900\", \"dark:text-white\", \"mb-6\"], [1, \"text-gray-600\", \"dark:text-gray-400\"]],\n    template: function ContactFormsComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"h1\", 2);\n        i0.ɵɵtext(3, \"Contact Forms Management\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(4, \"p\", 3);\n        i0.ɵɵtext(5, \"Contact forms management functionality coming soon...\");\n        i0.ɵɵelementEnd()()();\n      }\n    },\n    dependencies: [CommonModule, FormsModule, ReactiveFormsModule]\n  });\n  return ContactFormsComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}