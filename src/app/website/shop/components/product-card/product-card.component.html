<div class="product-card" (click)="navigateToProduct()">
  <div class="product-image-wrapper">
    <img
      *ngIf="!hasImageError('product-' + product._id)"
      [src]="getProductImageUrl(product)"
      [alt]="product.title"
      class="product-image"
      (error)="onImageError('product-' + product._id)"
      loading="lazy">
    <div *ngIf="hasImageError('product-' + product._id) || !product.imageCover"
         class="product-image d-flex align-items-center justify-content-center bg-light">
      <div class="text-center p-4">
        <i class="fas fa-image fa-3x text-muted mb-3"></i>
        <p class="text-muted small mb-0">لا توجد صورة</p>
      </div>
    </div>

    <!-- Discount Badge -->
    <span *ngIf="product.priceAfterDiscount" class="badge-sale" style="color: var(--text-dark) !important;">
      -{{ getDiscountPercentage(product) }}%
    </span>

    <!-- Hover Overlay with Actions -->
    <div class="product-overlay">
      <div class="d-flex gap-2">
        <button
          class="btn btn-light"
          (click)="addToCart(product, $event)"
          [attr.aria-label]="'إضافة إلى السلة'">
          <i class="fas fa-shopping-bag"></i>
        </button>
        <button
          class="btn btn-light"
          [class.active]="isFavorite(product._id)"
          (click)="toggleFavorite(product, $event)"
          [attr.aria-label]="isFavorite(product._id) ? 'إزالة من المفضلة' : 'إضافة إلى المفضلة'">
          <i class="fas"
             [ngClass]="{'fa-heart': isFavorite(product._id), 'far fa-heart': !isFavorite(product._id)}"
             [style.font-weight]="isFavorite(product._id) ? '900' : '400'"></i>
        </button>
      </div>
    </div>
  </div>

  <div class="product-info">
    <h3 class="product-title" [title]="product.title">
      {{ product.title }}
    </h3>
    <div class="product-price">
      <span class="current-price">{{ getProductPrice(product) | currency:'EGP':'symbol':'1.0-0' }}</span>
      <span *ngIf="getOriginalPrice(product)" class="original-price has-discount">
        {{ getOriginalPrice(product) | currency:'EGP':'symbol':'1.0-0' }}
      </span>
    </div>
  </div>
</div>
